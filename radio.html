<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background: #121212;
        }
    </style>
</head>
<body>
    <audio id="audioStream" preload="auto" crossorigin="anonymous">
        <source id="audioSource" src="https://stream.revma.ihrhls.com/zc185" type="audio/mpeg">
    </audio>

    <script>
        const audio = document.getElementById('audioStream');
        const audioSource = document.getElementById('audioSource');
        
        let isPlaying = false;
        let currentStationIndex = 0;
        let wakeLock = null;

        const stations = [
            {
                name: 'KIIS-FM 102.7',
                streamUrl: 'https://stream.revma.ihrhls.com/zc185'
            },
            {
                name: 'Antena 1 94.7',
                streamUrl: 'https://antenaone.crossradio.com.br/stream/1;'
            }
        ];

        // Request Wake Lock to prevent screen from sleeping and killing audio
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock active');
                    
                    wakeLock.addEventListener('release', () => {
                        console.log('Wake Lock released');
                    });
                }
            } catch (err) {
                console.log('Wake Lock error:', err);
            }
        }

        // Re-acquire wake lock when visibility changes
        document.addEventListener('visibilitychange', async () => {
            if (!document.hidden && isPlaying && wakeLock === null) {
                await requestWakeLock();
            }
        });

        // Prevent browser from suspending the page
        let keepAliveInterval = setInterval(() => {
            if (isPlaying) {
                // Empty function just to keep the page active
                void(0);
            }
        }, 1000);

        // Media Session API
        if ('mediaSession' in navigator) {
            navigator.mediaSession.setActionHandler('play', async () => {
                await reloadAndPlay();
            });

            navigator.mediaSession.setActionHandler('pause', () => {
                audio.pause();
                isPlaying = false;
                if (wakeLock) {
                    wakeLock.release();
                    wakeLock = null;
                }
            });

            navigator.mediaSession.setActionHandler('previoustrack', () => {
                switchStation(-1);
            });

            navigator.mediaSession.setActionHandler('nexttrack', () => {
                switchStation(1);
            });
        }

        function updateMediaSession() {
            if ('mediaSession' in navigator) {
                const currentStation = stations[currentStationIndex];
                document.title = currentStation.name;
                
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: currentStation.name,
                    artist: '',
                    album: ''
                });

                navigator.mediaSession.playbackState = isPlaying ? 'playing' : 'paused';
            }
        }

        async function reloadAndPlay() {
            audio.load();
            try {
                await audio.play();
                isPlaying = true;
                updateMediaSession();
                await requestWakeLock();
                console.log('Playing:', stations[currentStationIndex].name);
            } catch (err) {
                console.log('Play error:', err);
            }
        }

        function switchStation(direction) {
            currentStationIndex = (currentStationIndex + direction + stations.length) % stations.length;
            const station = stations[currentStationIndex];
            
            const wasPlaying = isPlaying;
            
            audio.pause();
            isPlaying = false;
            
            audioSource.src = station.streamUrl;
            updateMediaSession();
            
            if (wasPlaying) {
                reloadAndPlay();
            }
        }

        // Click to play
        document.body.addEventListener('click', async () => {
            if (!isPlaying) {
                await reloadAndPlay();
            }
        });

        // Update play state
        audio.addEventListener('play', () => {
            isPlaying = true;
            updateMediaSession();
        });

        audio.addEventListener('pause', () => {
            isPlaying = false;
            updateMediaSession();
        });

        // Initialize
        updateMediaSession();
        
        // Try auto-play
        reloadAndPlay().catch(() => {
            console.log('Auto-play blocked. Click screen to start.');
        });

        // Prevent scroll
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
